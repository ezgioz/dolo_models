# This file adapts the model described in
# "From Sudden Stops to Fisherian Deflation, Quantitative Theory and Policy"
# by Anton Korinek and Enrique G. Mendoza

name: Sudden Stop (General)

model_type: dtcc
symbols:

    exogenous: [y]
    states: [lw, le]
    controls: [be, lame, bw, lamw]
    #values: [Ve, Vce]
    parameters: [betae, betaw, R, sigma, a, mu, kappa, delta_y, pi, minl, maxl]
    #rewards: [ue]

definitions:
    yT: y/2
    yN: y/2
    yTe: yT/2
    yTw: yT/2
    yNe: yN/2
    yNw: yN/2
    yyTe: yTe + le - be/R
    yyTw: yTw + lw - bw/R
    p:  ( (1-a)/a )* ((yyTe+yyTw)/yN)^(1+mu)
    she: (p*yNw + yyTw)/(p*yN + yyTe+yyTw)
    cNw: she*yN
    cTw: she*(yyTe+yyTw)
    cNe: (1-she)*yN
    cTe: (1-she)*(yyTe+yyTw)
    cw: ( a*(cTw)^(-mu) + (1-a)*(cNw)^(-mu) )^(-1/mu)
    ce: ( a*(cTe)^(-mu) + (1-a)*(cNe)^(-mu) )^(-1/mu)


equations:

    transition:
        - lw = bw(-1)
        - le = be(-1)

    arbitrage:
        - lame = be/R +  kappa*(p*yNe +yTe)
        - 1 - betae*R*( (cTe(1)/cTe)^(-mu-1) ) *((ce(1)/ce)^(1-sigma+mu)) |  0 <= lame <= inf
        - lamw = bw/R +  kappa*(p*yNw +yTw)
        - 1 - betaw*R*( (cTw(1)/cTw)^(-mu-1) ) *((cw(1)/cw)^(1-sigma+mu)) |  0 <= lamw <= inf

    #value:
    #    - Ve = ce^(1.0-sigma)/(1.0-sigma) + beta*V(1)
    #    - Vce = ce^(1.0-sigma)/(1.0-sigma)


    #felicity:
    #    - ue =  ce^(1-sigma)/(1-sigma)


calibration:
    betae: 0.96
    betaw: 0.96
    R: 1.03
    sigma: 2.0
    a: 1/3
    mu: 1/4
    kappa: 1/4
    delta_y: 0.03
    pi: 0.05

# Deterministic steady state: initial values
    y: 2.0
    yT: y/2
    yN: y/2
    yTe: yT/2
    yTw: yT/2
    yNe: yN/2
    yNw: yN/2
    yyTe: yTe + le - be/R
    yyTw: yTw + lw - bw/R
    p:  ( (1-a)/a )* ((yyTe+yyTw)/yN)^(1+mu)
    she: (p*yNw + yyTw)/(p*yN + yyTe+yyTw)
    cNw: she*yN
    cTw: she*(yyTe+yyTw)
    cNe: (1-she)*yN
    cTe: (1-she)*(yyTe+yyTw)
    cw: ( a*(cTw)^(-mu) + (1-a)*(cNw)^(-mu) )^(-1/mu)
    ce: ( a*(cTe)^(-mu) + (1-a)*(cNe)^(-mu) )^(-1/mu)
    #Ve: ce^(1.0-sigma)/(1.0-sigma)/(1.0-beta)
    #Vce: ce^(1.0-sigma)/(1.0-sigma)
    #ue:  ce^(1-sigma)/(1-sigma)
    minl: min(-(1+kappa)*yT)
    maxl: 0.3
    be: 0
    bw: 0
    le: 0
    lw: 0

    lame: 2/3
    lamw: 2/3

exogenous: !MarkovChain
    values: [[ 2-2*delta_y  ],  # bad state
             [ 2.0 ]]          # good state
    transitions: [[ pi, 1-pi ],   # probabilities   [p(L|L), p(H|L)]
                  [ pi, 1-pi ]]     # probabilities   [p(L|H), p(H|H)]
domain:
    le: [minl, maxl]
    lw: [minl, maxl]
    #l: [-1, 1]
options:
    grid: !Cartesian
        orders: [20,20]

#exogenous: !Product
#    p1: !MarkovChain
#        values: [[ 1.0 - delta_y  ],  # bad state
#                 [ 1.0 ]]          # good state
#        transitions: [[ 0.5, 0.5 ],   # probabilities   [p(L|L), p(H|L)]
#                     [ 0.5, 0.5 ]]     # probabilities   [p(L|H), p(H|H)]
#    p2:  !MarkovChain
#       values: [[ 1.0 - delta_y  ],  # bad state
#                [ 1.0 ]]          # good state
#       transitions: [[ 0.5, 0.5],   # probabilities   [p(L|L), p(H|L)]
#                     [ 0.5, 0.5 ]]     # probabilities   [p(L|H), p(H|H)]
